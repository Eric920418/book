module.exports=[77923,(a,b,c)=>{"use strict";b.exports=a.r(47767).vendored.contexts.HooksClientContext},15932,(a,b,c)=>{"use strict";b.exports=a.r(47767).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},47767,(a,b,c)=>{"use strict";b.exports=a.r(18622)},46385,(a,b,c)=>{"use strict";b.exports=a.r(47767).vendored["react-ssr"].ReactJsxRuntime},70756,(a,b,c)=>{"use strict";b.exports=a.r(47767).vendored["react-ssr"].React},23793,(a,b,c)=>{"use strict";b.exports=a.r(47767).vendored.contexts.AppRouterContext},44835,(a,b,c)=>{"use strict";b.exports=a.r(47767).vendored["react-ssr"].ReactServerDOMTurbopackClient},26086,a=>{"use strict";var b=a.i(46385),c=a.i(70756),d=a.i(38384),e=a.i(995),f=a.i(92610),g=a.i(39436);function h(){let a=(0,d.useRouter)(),[f,h]=(0,c.useState)(!0),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(""),o=(0,c.useCallback)(async()=>{let b=localStorage.getItem("adminToken");if(!b)return a.push("/admin"),!1;try{let a,c=b.split(".");if(3!==c.length)throw Error(`Token 格式錯誤：JWT 應該包含三個部分，但實際有 ${c.length} 個部分

Token 預覽：${b.substring(0,50)}...`);try{let b=c[1];if(!/^[A-Za-z0-9_-]+$/.test(b))throw Error(`Payload 部分包含無效的 Base64URL 字元

Payload 預覽：${b.substring(0,50)}...`);let d=(a=>{let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;b+="=".repeat(c);try{return atob(b)}catch(a){throw Error(`Base64 解碼失敗：${a instanceof Error?a.message:"未知錯誤"}`)}})(b);a=JSON.parse(d)}catch(a){if(a instanceof Error){if(a.message.includes("Payload 部分包含無效"))throw a;throw Error(`Base64URL 解碼失敗：${a.message}

這通常表示 Token 已損壞或不是有效的 JWT。

Token 長度：${b.length} 字元
Payload 長度：${c[1].length} 字元
Payload 部分：${c[1].substring(0,50)}...`)}throw Error("Base64URL 解碼失敗：未知錯誤")}if(!a.name||!a.email)throw Error(`Token 內容不完整：缺少必要的用戶資訊

已找到的欄位：${Object.keys(a).join(", ")}
缺少的欄位：${!a.name?"name ":""}${!a.email?"email":""}`);if(a.exp&&1e3*a.exp<Date.now()){let b=new Date(1e3*a.exp);throw Error(`登入已過期，請重新登入

過期時間：${b.toLocaleString("zh-TW")}
當前時間：${new Date().toLocaleString("zh-TW")}`)}return n(""),!0}catch(d){let c=d instanceof Error?`❌ Token 驗證失敗

${d.message}`:"❌ Token 驗證失敗：未知錯誤";return console.error("========== Token 驗證失敗詳細資訊 =========="),console.error("錯誤：",d),console.error("Token 內容：",b),console.error("Token 長度：",b.length),console.error("Token 部分：",b.split(".").map((a,b)=>`部分 ${b+1}: ${a.substring(0,30)}...`)),console.error("==========================================="),n(c),h(!1),localStorage.removeItem("adminToken"),setTimeout(()=>{a.push("/admin")},3e3),!1}},[a]),p=(0,c.useCallback)(async()=>{try{let a=localStorage.getItem("adminToken"),b=await fetch("/api/admin/stats",{headers:{Authorization:`Bearer ${a}`}});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(`獲取統計資料失敗 (${b.status})：${a.error||a.message||"未知錯誤"}`)}let c=await b.json();j(c.data);let d=await fetch("/api/admin/results?limit=10",{headers:{Authorization:`Bearer ${a}`}});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(`獲取測驗結果失敗 (${d.status})：${a.error||a.message||"未知錯誤"}`)}let e=await d.json();l(e.data)}catch(b){let a=b instanceof Error?`❌ 資料載入錯誤：${b.message}`:"❌ 資料載入錯誤：未知錯誤";console.error("獲取資料失敗:",b),n(a)}finally{h(!1)}},[]);(0,c.useEffect)(()=>{(async()=>{await o()&&await p()})()},[o,p]);let q={labels:i?.dailyResults.map(a=>a.date)||[],datasets:[{label:"每日測驗人數",data:i?.dailyResults.map(a=>a.count)||[],borderColor:"rgb(37, 99, 235)",backgroundColor:"rgba(37, 99, 235, 0.1)",tension:.4,fill:!0}]},r={labels:i?Object.keys(i.dimensionAverages).map(a=>({noticing:"注意",notDistracting:"不分心",notWorrying:"不擔心",attentionRegulation:"注意調節",emotionalAwareness:"情緒覺察",selfRegulation:"自我調節",bodyListening:"身體聆聽",trusting:"身體信任"})[a]||a):[],datasets:[{label:"平均分數 (0-5分)",data:i?Object.values(i.dimensionAverages):[],backgroundColor:"rgba(88, 89, 91, 0.8)",borderColor:"rgba(88, 89, 91, 1)",borderWidth:1}]};return m?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,b.jsx)("div",{className:"max-w-md w-full mx-4",children:(0,b.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 border-2 border-red-500 rounded-lg p-6 text-center",children:[(0,b.jsxs)("div",{className:"text-red-600 dark:text-red-400 mb-4",children:[(0,b.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,b.jsx)("h2",{className:"text-xl font-bold mb-2",children:"驗證失敗"}),(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:m})]}),(0,b.jsx)("p",{className:"text-sm text-foreground/70 mt-4",children:"將在 3 秒後自動返回登入頁面..."}),(0,b.jsx)("button",{onClick:()=>a.push("/admin"),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"立即返回登入"})]})})}):f?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),(0,b.jsx)("p",{className:"mt-4 text-foreground/70",children:"載入中..."})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)("nav",{className:"bg-card border-b border-border sticky top-0 z-50",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("div",{children:(0,b.jsx)("h1",{className:"text-2xl font-bold text-primary",children:"管理後台"})}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(e.default,{href:"/",className:"text-foreground/70 hover:text-primary transition-colors",children:"返回前台"}),(0,b.jsx)("button",{onClick:()=>{localStorage.removeItem("adminToken"),a.push("/admin")},className:"px-4 py-2 bg-secondary text-secondary-foreground rounded-lg  hover:bg-secondary/90 transition-colors",children:"登出"})]})]})})}),(0,b.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,b.jsxs)("div",{className:"bg-card rounded-lg p-6 shadow-md",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-foreground/70 mb-2",children:"總測驗次數"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-primary",children:i?.totalResults||0})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg p-6 shadow-md",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-foreground/70 mb-2",children:"今日測驗"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-accent",children:i?.todayResults||0})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg p-6 shadow-md",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-foreground/70 mb-2",children:"平均分數"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-green-600",children:i?.averageScore.toFixed(1)||0})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg p-6 shadow-md",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-foreground/70 mb-2",children:"轉換率"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-purple-600",children:[i?.totalResults?(i.todayResults/i.totalResults*100).toFixed(1):0,"%"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(0,b.jsxs)("div",{className:"bg-card rounded-lg p-6 shadow-md",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"測驗趨勢（過去 7 天）"}),(0,b.jsx)("div",{className:"h-[300px]",children:(0,b.jsx)(g.Line,{data:q,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}}}})})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg p-6 shadow-md",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"MAIA-2 八個面向平均分數"}),(0,b.jsx)("div",{className:"h-[300px]",children:(0,b.jsx)(g.Bar,{data:r,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,max:5,ticks:{stepSize:1}}}}})})]})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg shadow-md overflow-hidden",children:[(0,b.jsx)("div",{className:"p-6 border-b border-border",children:(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"最新測驗結果"})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-secondary",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-secondary-foreground uppercase tracking-wider",children:"Email"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-secondary-foreground uppercase tracking-wider",children:"測驗類型"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-secondary-foreground uppercase tracking-wider",children:"平均分數"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-secondary-foreground uppercase tracking-wider",children:"完成時間"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-secondary-foreground uppercase tracking-wider",children:"操作"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-border",children:k.map(a=>{let c,d=0===(c=Object.values(a.dimensionScores)).length?0:Number((c.reduce((a,b)=>a+b,0)/c.length).toFixed(2));return(0,b.jsxs)("tr",{className:"hover:bg-secondary/50 transition-colors",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("div",{className:"text-sm font-medium",children:a.email})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("div",{className:"text-sm text-foreground/70",children:"MAIA-2 內感受量表"})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/20 text-primary",children:[d," / 5.00"]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-foreground/70",children:new Date(a.completedAt).toLocaleString("zh-TW")}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,b.jsx)("button",{onClick:()=>{localStorage.setItem("maia2Result",JSON.stringify(a.dimensionScores)),window.open("/quiz/result","_blank")},className:"text-primary hover:underline",children:"查看詳情"})})]},a.id)})})]})})]})]})]})}f.Chart.register(f.CategoryScale,f.LinearScale,f.PointElement,f.LineElement,f.BarElement,f.Title,f.Tooltip,f.Legend,f.ArcElement,f.Filler),a.s(["default",()=>h])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9906a164._.js.map